<!DOCTYPE html>
<html lang="bn">
<head>
    <title>‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶≤‡¶ï ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, private">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            text-align: center;
            padding: 20px;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            background: var(--tg-theme-bg-color, linear-gradient(135deg, #8B0000, #B22222, #DC143C));
            color: var(--tg-theme-text-color, white);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            touch-action: none;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            transition: all 0.3s ease;
        }
        .container {
            background: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.9));
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            max-width: 400px;
            width: 90%;
            border: 3px solid var(--tg-theme-button-color, #ff4444);
        }
        h1 {
            color: var(--tg-theme-text-color, #fff);
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        #timer {
            font-size: 2.5em;
            color: var(--tg-theme-button-color, #ffcc00);
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            font-family: 'Courier New', monospace;
        }
        .progress-container {
            width: 100%;
            height: 15px;
            background: var(--tg-theme-hint-color, rgba(255, 255, 255, 0.2));
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--tg-theme-button-color, #ff416c), var(--tg-theme-button-color, #ff4b2b));
            border-radius: 10px;
            transition: width 1s linear;
        }
        .message {
            margin-top: 15px;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #ddd);
        }
        .warning {
            color: var(--tg-theme-destructive-text-color, #ff9999);
            font-size: 12px;
            margin-top: 8px;
            line-height: 1.4;
        }
        .navigation-blocked {
            color: var(--tg-theme-button-color, #ff5555);
            font-weight: bold;
            margin-top: 12px;
            font-size: 16px;
            background: var(--tg-theme-secondary-bg-color, rgba(255, 0, 0, 0.2));
            padding: 8px;
            border-radius: 5px;
        }
        .hidden { 
            display: none; 
        }
        
        /* Navigation buttons blocker overlay */
        #nav-blocker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-bg-color, rgba(0, 0, 0, 0.98));
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: var(--tg-theme-text-color, white);
            font-size: 20px;
            text-align: center;
            padding: 20px;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        .nav-button {
            width: 60px;
            height: 60px;
            margin: 0 10px;
            background: var(--tg-theme-secondary-bg-color, rgba(255, 0, 0, 0.4));
            border: 3px solid var(--tg-theme-button-color, #ff5555);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        #close-nav-blocker {
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--tg-theme-button-color, #ff5555);
            border: none;
            border-radius: 5px;
            color: var(--tg-theme-button-text-color, white);
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .penalty-notice {
            color: var(--tg-theme-destructive-text-color, #ff9999);
            margin-top: 12px;
            font-size: 14px;
        }
        
        /* Prevent text selection */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Disable tap highlight on mobile */
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        .attempt-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--tg-theme-button-color, rgba(255, 0, 0, 0.8));
            color: var(--tg-theme-button-text-color, white);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .protection-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.7));
            color: var(--tg-theme-text-color, white);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            z-index: 1000;
        }
        
        .protection-level {
            color: var(--tg-theme-button-color, #ffcc00);
            font-weight: bold;
        }
        
        /* Home Button Blocker */
        #home-blocker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-bg-color, rgba(0, 0, 0, 0.95));
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: var(--tg-theme-text-color, white);
            font-size: 20px;
            text-align: center;
            padding: 20px;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .home-blocker-content {
            background: var(--tg-theme-secondary-bg-color, rgba(255, 0, 0, 0.2));
            padding: 25px;
            border-radius: 15px;
            border: 3px solid var(--tg-theme-button-color, #ff4444);
            max-width: 90%;
        }
        
        #close-home-blocker {
            margin-top: 15px;
            padding: 10px 20px;
            background: var(--tg-theme-button-color, #ff5555);
            border: none;
            border-radius: 5px;
            color: var(--tg-theme-button-text-color, white);
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Emergency PIN Styles */
        #emergency-pin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-bg-color, rgba(0, 0, 0, 0.95));
            z-index: 10001;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: var(--tg-theme-text-color, white);
            font-size: 20px;
            text-align: center;
            padding: 20px;
        }
        
        .pin-container {
            background: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.8));
            padding: 30px;
            border-radius: 15px;
            border: 3px solid var(--tg-theme-button-color, #4CAF50);
            max-width: 90%;
            width: 350px;
        }
        
        .pin-input {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            font-size: 20px;
            text-align: center;
            background: var(--tg-theme-bg-color, #fff);
            border: 2px solid var(--tg-theme-button-color, #4CAF50);
            border-radius: 8px;
            color: var(--tg-theme-text-color, #000);
        }
        
        .pin-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .pin-btn {
            padding: 15px;
            font-size: 18px;
            background: var(--tg-theme-button-color, #4CAF50);
            border: none;
            border-radius: 8px;
            color: var(--tg-theme-button-text-color, white);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pin-btn:hover {
            background: var(--tg-theme-button-color, #45a049);
            transform: scale(1.05);
        }
        
        .pin-clear {
            background: var(--tg-theme-destructive-text-color, #ff5555);
        }
        
        .pin-submit {
            background: var(--tg-theme-button-color, #2196F3);
        }
        
        /* Game Challenge Styles */
        .game-btn {
            padding: 12px 20px;
            margin: 8px;
            background: var(--tg-theme-button-color, #ff5555);
            border: none;
            border-radius: 8px;
            color: var(--tg-theme-button-text-color, white);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .game-btn:hover {
            background: var(--tg-theme-button-color, #ff3333);
            transform: scale(1.1);
        }
        
        #game-status {
            margin-top: 12px;
            font-size: 16px;
            color: var(--tg-theme-button-color, #ffcc00);
        }
        
        /* Why Locked Button */
        #why-locked {
            margin-top: 15px;
            padding: 8px 16px;
            background: transparent;
            border: 2px solid var(--tg-theme-button-color, #ffcc00);
            border-radius: 5px;
            color: var(--tg-theme-button-color, #ffcc00);
            font-size: 12px;
            cursor: pointer;
        }
        
        /* Emergency Access Button */
        #emergency-access {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: transparent;
            border: 1px solid var(--tg-theme-button-color, #4CAF50);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: var(--tg-theme-button-color, #4CAF50);
            font-size: 12px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Telegram Theme Adaptation */
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f4f4f5;
            --tg-theme-header-bg-color: #ffffff;
            --tg-theme-accent-text-color: #2481cc;
            --tg-theme-section-bg-color: #ffffff;
            --tg-theme-section-header-text-color: #2481cc;
            --tg-theme-subtitle-text-color: #999999;
            --tg-theme-destructive-text-color: #ff3b30;
        }

        .dark-mode {
            --tg-theme-bg-color: #000000;
            --tg-theme-text-color: #ffffff;
            --tg-theme-hint-color: #666666;
            --tg-theme-link-color: #5e9be2;
            --tg-theme-button-color: #5e9be2;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #1c1c1d;
            --tg-theme-header-bg-color: #000000;
            --tg-theme-accent-text-color: #5e9be2;
            --tg-theme-section-bg-color: #000000;
            --tg-theme-section-header-text-color: #5e9be2;
            --tg-theme-subtitle-text-color: #666666;
            --tg-theme-destructive-text-color: #ff453a;
        }
    </style>
</head>
<body oncontextmenu="return false;" ondragstart="return false;" onselectstart="return false;">
    <noscript>
        <div class="container">
            <h1>JavaScript ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡ßü!</h1>
            <p>‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá JavaScript ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        </div>
    </noscript>
    
    <div class="attempt-counter" id="attempt-counter">
        ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ: <span id="attempt-count">0</span>
    </div>
    
    <div class="protection-status" id="protection-status">
        ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡ßç‡¶§‡¶∞: <span class="protection-level">‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶â‡¶ö‡ßç‡¶ö</span>
    </div>
    
    <button id="emergency-access" title="‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏">üîì</button>
    
    <div id="nav-blocker" class="hidden">
        <h2>üö´ ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!</h2>
        <div class="nav-buttons">
            <div class="nav-button">‚Üê</div>
            <div class="nav-button">‚óØ</div>
            <div class="nav-button">‚ò∞</div>
        </div>
        <p><strong>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï, ‡¶π‡ßã‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ø‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶∏ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</strong></p>
        <p>‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶®‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶è‡¶á ‡¶¨‡¶æ‡¶ü‡¶®‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ</p>
        <p class="penalty-notice" id="penalty-text"></p>
        <button id="close-nav-blocker">‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø, ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ö‡¶æ‡¶™‡¶¨‡ßã ‡¶®‡¶æ</button>
    </div>
    
    <!-- Home Button Blocker -->
    <div id="home-blocker">
        <div class="home-blocker-content">
            <h2>üö´ ‡¶π‡ßã‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!</h2>
            <div class="nav-button" style="margin: 15px auto;">‚óØ</div>
            <p><strong>‡¶π‡ßã‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</strong></p>
            <p>‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶®‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶π‡ßã‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ</p>
            <p class="penalty-notice" id="home-penalty-text"></p>
            <p class="warning">‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ</p>
            <button id="close-home-blocker">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
        </div>
    </div>
    
    <!-- Emergency PIN Overlay -->
    <div id="emergency-pin-overlay">
        <div class="pin-container">
            <h2>üîì ‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏</h2>
            <p>‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡¶®:</p>
            <input type="password" id="pin-input" class="pin-input" placeholder="‡¶™‡¶ø‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" maxlength="11" readonly>
            <div class="pin-buttons">
                <button class="pin-btn" data-number="1">1</button>
                <button class="pin-btn" data-number="2">2</button>
                <button class="pin-btn" data-number="3">3</button>
                <button class="pin-btn" data-number="4">4</button>
                <button class="pin-btn" data-number="5">5</button>
                <button class="pin-btn" data-number="6">6</button>
                <button class="pin-btn" data-number="7">7</button>
                <button class="pin-btn" data-number="8">8</button>
                <button class="pin-btn" data-number="9">9</button>
                <button class="pin-btn pin-clear" id="pin-clear">C</button>
                <button class="pin-btn" data-number="0">0</button>
                <button class="pin-btn pin-submit" id="pin-submit">‚úì</button>
            </div>
            <p id="pin-status" class="warning"></p>
            <button id="close-pin-overlay" style="margin-top: 15px; padding: 8px 16px; background: #666; border: none; border-radius: 5px; color: white; cursor: pointer;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
    </div>
    
    <div class="container">
        <h1>‚è≥ ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</h1>
        <div id="timer" aria-live="polite">5:00</div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <p class="message">‡¶è‡¶á ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>
        <p class="navigation-blocked">üö´ ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>
        <p class="warning">‚Ä¢ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® (‚Üê) - ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá<br>
           ‚Ä¢ ‡¶π‡ßã‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶® (‚óØ) - ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá<br>
           ‚Ä¢ ‡¶∞‡¶ø‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶∏ ‡¶¨‡¶æ‡¶ü‡¶® (‚ò∞) - ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>
        <p class="warning">‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶æ‡¶ü‡¶®‡¶á ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>
        <button id="why-locked">‡¶ï‡ßá‡¶® ‡¶è‡¶á ‡¶™‡ßá‡¶ú ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ?</button>
    </div>

    <script>
        // Emergency PIN Configuration
        const EMERGENCY_PIN = "01929793487";
        let pinAttempts = 0;
        const MAX_PIN_ATTEMPTS = 3;

        // Telegram WebApp Initialization
        const Telegram = window.Telegram?.WebApp;
        let isTelegramWebApp = false;

        if (Telegram) {
            isTelegramWebApp = true;
            Telegram.ready();
            Telegram.expand();
            Telegram.disableClosingConfirmation();
            
            // Apply Telegram theme
            applyTelegramTheme();
            
            // Setup Main Button
            setupTelegramMainButton();
            
            // Setup event listeners
            setupTelegramEvents();
        }

        function applyTelegramTheme() {
            const isDark = Telegram.colorScheme === 'dark';
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
            
            // Apply dynamic colors from Telegram
            if (Telegram.backgroundColor) {
                document.documentElement.style.setProperty('--tg-theme-bg-color', Telegram.backgroundColor);
            }
            if (Telegram.headerColor) {
                document.documentElement.style.setProperty('--tg-theme-text-color', Telegram.headerColor);
            }
        }

        function setupTelegramMainButton() {
            const mainButton = Telegram.MainButton;
            mainButton.setText("üîí ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º");
            mainButton.show();
            
            mainButton.onClick(() => {
                Telegram.showAlert("‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            });
        }

        function setupTelegramEvents() {
            // Prevent app closing
            Telegram.onEvent('web_app_close', () => {
                if (isLocked) {
                    Telegram.showAlert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ! ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                    saveTimerState();
                    return false;
                }
            });

            // Handle back button
            Telegram.BackButton.hide();

            // Handle visibility changes
            Telegram.onEvent('viewportChanged', (e) => {
                if (isLocked && !e.isStateStable) {
                    handleTelegramEscapeAttempt();
                }
            });
        }

        function handleTelegramEscapeAttempt() {
            Telegram.HapticFeedback.impactOccurred('heavy');
            showTelegramPopup();
            timeLeft += 45;
            updateTimerDisplay();
            saveTimerState();
        }

        function showTelegramPopup() {
            Telegram.showPopup({
                title: "üö´ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶õ‡¶æ‡¶°‡¶º‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ!",
                message: "‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶õ‡¶æ‡¶°‡¶º‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶õ‡ßá‡¶®‡•§ ‡¶è‡¶ü‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º‡•§",
                buttons: [
                    { id: 'return', type: 'default', text: '‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡ßÅ‡¶®' },
                    { id: 'penalty', type: 'destructive', text: '‡¶ú‡¶æ‡¶®‡¶ø ‡¶®‡¶æ' }
                ]
            }, (buttonId) => {
                if (buttonId === 'return') {
                    Telegram.expand();
                    Telegram.showAlert("‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶∏‡ßá‡¶õ‡ßá‡¶®‡•§");
                } else {
                    timeLeft += 60;
                    updateTimerDisplay();
                    Telegram.showAlert("‡¶Ö‡¶®‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ! +‡ß¨‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                }
            });
        }

        // Emergency PIN Functions
        function setupPinEvents() {
            const pinInput = document.getElementById('pin-input');
            const pinButtons = document.querySelectorAll('.pin-btn[data-number]');
            const pinClear = document.getElementById('pin-clear');
            const pinSubmit = document.getElementById('pin-submit');
            const closePinOverlay = document.getElementById('close-pin-overlay');
            const emergencyAccess = document.getElementById('emergency-access');

            // Number buttons
            pinButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const number = btn.getAttribute('data-number');
                    if (pinInput.value.length < 11) {
                        pinInput.value += number;
                        updatePinStatus();
                    }
                });
            });

            // Clear button
            pinClear.addEventListener('click', () => {
                pinInput.value = '';
                updatePinStatus();
            });

            // Submit button
            pinSubmit.addEventListener('click', validatePin);

            // Close overlay
            closePinOverlay.addEventListener('click', () => {
                document.getElementById('emergency-pin-overlay').style.display = 'none';
                pinInput.value = '';
                updatePinStatus();
            });

            // Emergency access button
            emergencyAccess.addEventListener('click', () => {
                document.getElementById('emergency-pin-overlay').style.display = 'flex';
            });

            // Enter key support
            pinInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    validatePin();
                }
            });
        }

        function updatePinStatus() {
            const pinStatus = document.getElementById('pin-status');
            const pinLength = document.getElementById('pin-input').value.length;
            
            if (pinLength === 0) {
                pinStatus.textContent = "‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶™‡¶ø‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";
                pinStatus.style.color = "var(--tg-theme-hint-color, #999)";
            } else if (pinLength < 11) {
                pinStatus.textContent = `${pinLength}/11 ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ`;
                pinStatus.style.color = "var(--tg-theme-button-color, #4CAF50)";
            } else {
                pinStatus.textContent = "‡¶™‡¶ø‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£! ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
                pinStatus.style.color = "var(--tg-theme-button-color, #4CAF50)";
            }
        }

        function validatePin() {
            const enteredPin = document.getElementById('pin-input').value;
            const pinStatus = document.getElementById('pin-status');

            if (enteredPin === EMERGENCY_PIN) {
                // Success - unlock everything
                unlockSystem();
                pinStatus.textContent = "‚úÖ ‡¶∏‡¶´‡¶≤! ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá";
                pinStatus.style.color = "var(--tg-theme-button-color, #4CAF50)";
                
                setTimeout(() => {
                    document.getElementById('emergency-pin-overlay').style.display = 'none';
                    if (isTelegramWebApp) {
                        Telegram.showAlert("‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ó‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶ü‡ßá‡¶°! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§");
                        Telegram.close();
                    } else {
                        showAlert("‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ó‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶ü‡ßá‡¶°! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§", false);
                    }
                }, 2000);
            } else {
                pinAttempts++;
                pinStatus.textContent = `‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®! ${MAX_PIN_ATTEMPTS - pinAttempts} ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶¨‡¶æ‡¶ï‡¶ø`;
                pinStatus.style.color = "var(--tg-theme-destructive-text-color, #ff5555)";
                
                if (pinAttempts >= MAX_PIN_ATTEMPTS) {
                    pinStatus.textContent = "‚ùå ‡¶Ö‡¶®‡ßá‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®! ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã";
                    timeLeft += 300;
                    updateTimerDisplay();
                    setTimeout(() => {
                        document.getElementById('emergency-pin-overlay').style.display = 'none';
                        pinInput.value = '';
                        pinAttempts = 0;
                        updatePinStatus();
                    }, 3000);
                }
                
                // Shake animation for wrong PIN
                document.querySelector('.pin-container').style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => {
                    document.querySelector('.pin-container').style.animation = '';
                }, 500);
            }
        }

        function unlockSystem() {
            isLocked = false;
            clearInterval(timer);
            localStorage.removeItem('startTime');
            
            if (isTelegramWebApp) {
                Telegram.MainButton.setText("‚úÖ ‡¶Ü‡¶®‡¶≤‡¶ï‡¶°");
                Telegram.MainButton.onClick(() => {
                    Telegram.close();
                });
            }
            
            // Show unlocked message
            document.querySelector('.container').innerHTML = `
                <h1>‚úÖ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶®‡¶≤‡¶ï‡¶°!</h1>
                <div style="font-size: 3em; margin: 15px 0;">üîì</div>
                <p class="message">‡¶á‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
                <p class="warning">‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®</p>
                <p class="warning">‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ: ${navButtonAttempts}</p>
                <p class="warning">‡¶π‡ßã‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ: ${homeButtonAttempts}</p>
            `;
        }

        // Cloud Storage Functions
        function saveTimerState() {
            if (!isTelegramWebApp) return;
            
            const state = {
                timeLeft,
                startTime,
                navButtonAttempts,
                homeButtonAttempts,
                historyEntries,
                timestamp: Date.now()
            };
            
            Telegram.CloudStorage.setItem('timer_state', JSON.stringify(state), (err) => {
                if (!err) {
                    console.log('‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
                }
            });
        }

        function loadTimerState() {
            if (!isTelegramWebApp) return;
            
            Telegram.CloudStorage.getItem('timer_state', (err, value) => {
                if (!err && value) {
                    try {
                        const state = JSON.parse(value);
                        const timePassed = Math.floor((Date.now() - state.timestamp) / 1000);
                        
                        timeLeft = Math.max(0, state.timeLeft - timePassed);
                        startTime = state.startTime;
                        navButtonAttempts = state.navButtonAttempts || 0;
                        homeButtonAttempts = state.homeButtonAttempts || 0;
                        historyEntries = state.historyEntries || 0;
                        
                        updateTimerDisplay();
                        attemptCounter.textContent = navButtonAttempts;
                        
                        if (timeLeft > 0) {
                            Telegram.showAlert(`‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∏‡¶Æ‡¶Ø‡¶º: ${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2, '0')}`);
                        }
                    } catch (e) {
                        console.error('‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶≤‡ßã‡¶°‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', e);
                    }
                }
            });
        }

        // Timer and lock variables
        let timeLeft;
        let isLocked = true;
        const timerDisplay = document.getElementById('timer');
        const progressBar = document.getElementById('progress-bar');
        const attemptCounter = document.getElementById('attempt-count');
        let devToolsDetected = false;
        let backButtonPressed = false;
        let historyEntries = 0;
        const maxHistoryEntries = 10000;
        let navButtonAttempts = 0;
        let homeButtonAttempts = 0;
        let lastVisibilityChange = Date.now();
        let isPageHidden = false;
        let lastBackButtonTime = 0;
        let backButtonPressCount = 0;
        let homeButtonPressCount = 0;
        let recentAppsPressCount = 0;

        // Initialize systems
        setupPinEvents();
        if (isTelegramWebApp) {
            loadTimerState();
        }

        // Persist timer state
        let startTime = localStorage.getItem('startTime');
        if (!startTime) {
            startTime = Date.now();
            localStorage.setItem('startTime', startTime);
        }
        
        if (typeof timeLeft === 'undefined') {
            timeLeft = Math.max(0, 300 - Math.floor((Date.now() - startTime) / 1000));
        }

        // Ultra Aggressive History Flooding (2-7ms interval)
        function lockNavigation() {
            if (isLocked && historyEntries < maxHistoryEntries) {
                const randomId = Math.random().toString(36).substr(2, 15);
                try {
                    window.history.pushState(
                        { 
                            id: randomId, 
                            locked: true, 
                            timestamp: Date.now(),
                            attempt: navButtonAttempts,
                            homeAttempt: homeButtonAttempts
                        },
                        null,
                        window.location.href + '#locked_' + randomId + '_' + Date.now()
                    );
                    historyEntries++;
                } catch(e) {
                    // History might be full, continue anyway
                }
                
                // Continue with random interval between 2-7ms
                const nextInterval = Math.floor(Math.random() * 5) + 2;
                setTimeout(lockNavigation, nextInterval);
            }
        }
        
        // Initialize history lock
        try {
            window.history.replaceState(
                {id: "initial_lock", locked: true, timestamp: Date.now()}, 
                null, 
                window.location.href
            );
        } catch(e) {}
        
        // Start aggressive history flooding immediately
        lockNavigation();

        // Enhanced back button prevention
        window.onpopstate = function(event) {
            if (isLocked) {
                const now = Date.now();
                navButtonAttempts++;
                attemptCounter.textContent = navButtonAttempts;
                backButtonPressCount++;
                
                // Detect rapid back button presses
                if (now - lastBackButtonTime < 1000) {
                    backButtonPressCount++;
                    if (backButtonPressCount >= 3) {
                        const penalty = 30;
                        timeLeft += penalty;
                        updateTimerDisplay();
                        showAlert(`‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                        document.getElementById('penalty-text').textContent = 
                            `‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∂‡¶æ‡¶∏‡ßç‡¶§‡¶ø: +${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°!`;
                        backButtonPressCount = 0;
                    }
                } else {
                    backButtonPressCount = 1;
                }
                
                lastBackButtonTime = now;
                
                if (!backButtonPressed) {
                    backButtonPressed = true;
                    showNavBlocker("‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® (‚Üê) ‡¶ö‡¶æ‡¶™‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶è‡¶á ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§");
                }
                
                // Add more history entries aggressively
                lockNavigation();
                
                // Add penalty time for back button press
                if (navButtonAttempts % 2 === 0) {
                    const penalty = 15;
                    timeLeft += penalty;
                    updateTimerDisplay();
                    showAlert(`‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                    document.getElementById('penalty-text').textContent = 
                        `‡¶∂‡¶æ‡¶∏‡ßç‡¶§‡¶ø: +${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`;
                }
                
                // Vibrate on mobile if available
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200, 100, 200]);
                }
                
                // Telegram haptic feedback
                if (isTelegramWebApp) {
                    Telegram.HapticFeedback.impactOccurred('medium');
                }
                
                // Save state
                saveTimerState();
                
                // Prevent default behavior
                event.preventDefault();
                event.stopImmediatePropagation();
                return false;
            }
        };

        // Enhanced Home Button Detection and Control
        let lastBlurTime = 0;
        let focusAttempts = 0;
        let lastHomeButtonTime = 0;
        let homeButtonBlockActive = false;
        
        // Page visibility change detection - for Home/Recent Apps buttons
        document.addEventListener('visibilitychange', function() {
            if (isLocked) {
                const now = Date.now();
                
                if (document.hidden) {
                    // Page became hidden (Home or Recent Apps button pressed)
                    lastBlurTime = now;
                    isPageHidden = true;
                    homeButtonAttempts++;
                    navButtonAttempts++;
                    attemptCounter.textContent = navButtonAttempts;
                    
                    // Detect which button was pressed based on timing
                    if (now - lastHomeButtonTime < 2000) {
                        homeButtonPressCount++;
                        if (homeButtonPressCount >= 2) {
                            const penalty = 45;
                            timeLeft += penalty;
                            updateTimerDisplay();
                            showAlert(`‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶π‡ßã‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                            document.getElementById('home-penalty-text').textContent = 
                                `‡¶∂‡¶æ‡¶∏‡ßç‡¶§‡¶ø: +${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`;
                        }
                    } else {
                        homeButtonPressCount = 1;
                        recentAppsPressCount++;
                    }
                    
                    lastHomeButtonTime = now;
                    
                    // Show game challenge instead of simple blocker
                    if (isTelegramWebApp) {
                        handleTelegramEscapeAttempt();
                    } else {
                        showGameChallenge();
                    }
                    
                    // Add significant penalty time
                    const penalty = 30;
                    timeLeft += penalty;
                    updateTimerDisplay();
                    
                    document.getElementById('home-penalty-text').textContent = 
                        `‡¶∂‡¶æ‡¶∏‡ßç‡¶§‡¶ø: +${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`;
                    
                    showAlert(`‡¶π‡ßã‡¶Æ/‡¶∞‡¶ø‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                    
                    // Save state
                    saveTimerState();
                    
                    // Aggressive refocus attempt - bring back to app
                    setTimeout(() => {
                        if (isPageHidden) {
                            window.focus();
                            // Try multiple methods to bring back to app
                            const fakeEvent = new Event('visibilitychange');
                            document.dispatchEvent(fakeEvent);
                            
                            // Additional methods to regain focus
                            if (document.hidden && !isTelegramWebApp) {
                                window.location.reload();
                            }
                        }
                    }, 50);
                    
                } else {
                    // Page became visible again
                    isPageHidden = false;
                    const hiddenDuration = now - lastBlurTime;
                    
                    if (hiddenDuration > 100) {
                        // If page was hidden for more than 100ms, consider it a navigation attempt
                        focusAttempts++;
                        
                        if (focusAttempts > 2) {
                            const penalty = 20;
                            timeLeft += penalty;
                            updateTimerDisplay();
                            showAlert(`‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
                        }
                    }
                }
                
                lastVisibilityChange = now;
            }
        });

        // Enhanced page leave prevention with redirect
        window.addEventListener('beforeunload', (e) => {
            if (isLocked) {
                e.preventDefault();
                e.returnValue = '‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶®‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶™‡ßá‡¶ú ‡¶õ‡¶æ‡¶°‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ!';
                
                // Save state
                saveTimerState();
                
                if (isTelegramWebApp) {
                    Telegram.showAlert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ! ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶¨‡ßç‡¶Ø‡¶æ‡¶π‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§");
                } else {
                    // Show game challenge
                    showGameChallenge();
                    
                    // Redirect back after 50ms
                    setTimeout(() => {
                        window.location.href = window.location.href;
                    }, 50);
                }
                
                return '‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶®‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶™‡ßá‡¶ú ‡¶õ‡¶æ‡¶°‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ!';
            }
        });

        // Enhanced timer logic
        function updateTimerDisplay() {
            if (!timerDisplay) return;
            
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            // Update progress bar
            const progressPercent = (300 - timeLeft) / 300 * 100;
            progressBar.style.width = `${progressPercent}%`;
        }
        
        let timer;
        if (timerDisplay) {
            timer = setInterval(() => {
                if (devToolsDetected) return;
                
                updateTimerDisplay();
                timeLeft--;

                if (timeLeft < 0) {
                    clearInterval(timer);
                    isLocked = false;
                    localStorage.removeItem('startTime');
                    
                    if (isTelegramWebApp) {
                        Telegram.showAlert("üéâ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑! ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§");
                        Telegram.MainButton.setText("‚úÖ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑");
                        Telegram.MainButton.onClick(() => {
                            Telegram.close();
                        });
                    } else {
                        showAlert("üéâ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑! ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§", false);
                    }
                    
                    window.onpopstate = null;
                    window.removeEventListener('beforeunload', () => {});
                    document.oncontextmenu = null;
                    
                    // Clean up history
                    try {
                        window.history.go(-historyEntries);
                    } catch(e) {}
                    
                    // Show completion message
                    document.querySelector('.container').innerHTML = `
                        <h1>üéâ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑!</h1>
                        <div style="font-size: 3em; margin: 15px 0;">‚úÖ</div>
                        <p class="message">‡¶è‡¶ñ‡¶® ‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®</p>
                        <p class="warning">‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ: ${navButtonAttempts}</p>
                        <p class="warning">‡¶π‡ßã‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ: ${homeButtonAttempts}</p>
                    `;
                }
                
                // Save state every 10 seconds
                if (timeLeft % 10 === 0) {
                    saveTimerState();
                }
            }, 1000);
            
            updateTimerDisplay();
        }

        // Enhanced navigation blocker functions
        function showNavBlocker(message) {
            const navBlocker = document.getElementById('nav-blocker');
            const messageElement = navBlocker.querySelector('p');
            if (message) {
                messageElement.textContent = message;
            }
            navBlocker.classList.remove('hidden');
            
            // Auto hide after 4 seconds
            setTimeout(() => {
                if (!navBlocker.classList.contains('hidden')) {
                    navBlocker.classList.add('hidden');
                }
            }, 4000);
        }
        
        // Close nav blocker button
        document.getElementById('close-nav-blocker').addEventListener('click', function() {
            document.getElementById('nav-blocker').classList.add('hidden');
        });
        
        // Close home blocker button
        document.getElementById('close-home-blocker').addEventListener('click', function() {
            document.getElementById('home-blocker').style.display = 'none';
            homeButtonBlockActive = false;
        });

        // Why locked button
        document.getElementById('why-locked').addEventListener('click', function() {
            if (isTelegramWebApp) {
                Telegram.showAlert("‡¶è‡¶á ‡¶™‡ßá‡¶ú ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶´‡ßã‡¶ï‡¶æ‡¶∏‡¶° ‡¶•‡¶æ‡¶ï‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§");
            } else {
                showAlert("‡¶è‡¶á ‡¶™‡ßá‡¶ú ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶´‡ßã‡¶ï‡¶æ‡¶∏‡¶° ‡¶•‡¶æ‡¶ï‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§", false);
            }
        });

        // Enhanced alert function
        function showAlert(message, isError = true) {
            if (isTelegramWebApp) {
                Telegram.showAlert(message);
                return;
            }
            
            const alertBox = document.createElement('div');
            alertBox.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${isError ? '#d32f2f' : '#388e3c'};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                font-weight: bold;
                max-width: 90%;
                text-align: center;
            `;
            alertBox.textContent = message;
            document.body.appendChild(alertBox);
            
            setTimeout(() => {
                if (document.body.contains(alertBox)) {
                    document.body.removeChild(alertBox);
                }
            }, 3000);
        }

        // Enhanced attempts counter update
        attemptCounter.textContent = navButtonAttempts;
        
        // Protection status update
        setInterval(() => {
            const statusElement = document.getElementById('protection-status');
            if (navButtonAttempts > 10) {
                statusElement.innerHTML = '‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡ßç‡¶§‡¶∞: <span class="protection-level">‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶â‡¶ö‡ßç‡¶ö (‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶π‡ßÅ‡¶Æ‡¶ï‡¶ø)</span>';
            } else if (navButtonAttempts > 5) {
                statusElement.innerHTML = '‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡ßç‡¶§‡¶∞: <span class="protection-level">‡¶â‡¶ö‡ßç‡¶ö (‡¶π‡ßÅ‡¶Æ‡¶ï‡¶ø ‡¶∂‡¶®‡¶æ‡¶ï‡ßç‡¶§)</span>';
            } else {
                statusElement.innerHTML = '‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡ßç‡¶§‡¶∞: <span class="protection-level">‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶â‡¶ö‡ßç‡¶ö</span>';
            }
        }, 1000);

        // Periodic state saving
        setInterval(saveTimerState, 10000);
    </script>
</body>
</html>
