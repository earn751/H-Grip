<!DOCTYPE html>
<html lang="bn">
<head>
    <title>‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶≤‡¶ï‡¶° ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ - ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, private">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            text-align: center;
            padding: 20px;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background: var(--tg-theme-bg-color, #1a2a6c);
            color: var(--tg-theme-text-color, white);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            touch-action: none;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        .container {
            background: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.9));
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 95%;
            border: 3px solid var(--tg-theme-button-color, #ff4444);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            color: var(--tg-theme-text-color, white);
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #timer {
            font-size: 2.5em;
            color: var(--tg-theme-button-color, #ffcc00);
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            font-family: 'Courier New', monospace;
        }
        
        .progress-container {
            width: 100%;
            height: 15px;
            background: var(--tg-theme-hint-color, rgba(255, 255, 255, 0.2));
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
            border-radius: 10px;
            transition: width 1s linear;
        }
        
        .message {
            margin-top: 15px;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #ddd);
            line-height: 1.4;
        }
        
        .warning {
            color: #ff9999;
            font-size: 12px;
            margin-top: 10px;
            line-height: 1.4;
        }
        
        .navigation-blocked {
            color: #ff5555;
            font-weight: bold;
            margin-top: 15px;
            font-size: 16px;
            background: rgba(255, 0, 0, 0.2);
            padding: 8px;
            border-radius: 8px;
        }
        
        .hidden { 
            display: none; 
        }
        
        /* Popup Styles */
        #popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-in;
        }
        
        .popup-content {
            background: linear-gradient(135deg, #dc143c, #b22222);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            max-width: 90%;
            width: 350px;
            border: 3px solid #ffcc00;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .popup-icon {
            font-size: 50px;
            margin-bottom: 15px;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .popup-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 12px;
            color: white;
        }
        
        .popup-message {
            font-size: 14px;
            margin-bottom: 15px;
            color: #ffe6e6;
            line-height: 1.4;
        }
        
        .popup-penalty {
            font-size: 16px;
            font-weight: bold;
            color: #ffcc00;
            margin: 12px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        #popup-close {
            background: #ffcc00;
            color: #b22222;
            border: none;
            padding: 10px 25px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s ease;
        }
        
        .nav-buttons-popup {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        .nav-button-popup {
            width: 40px;
            height: 40px;
            margin: 0 8px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #ffcc00;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
        }
        
        .attempt-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 999;
        }
        
        /* Auto return notification */
        #auto-return-notice {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 204, 0, 0.9);
            color: #b22222;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 10001;
            animation: pulse 2s infinite;
            font-size: 12px;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ffcc00;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-active {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        .status-locked {
            background: #ff4444;
        }
    </style>
</head>
<body>
    <noscript>
        <meta http-equiv="refresh" content="0;url=/no-js-error">
        <div class="container">
            <h1>JavaScript ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡ßü!</h1>
            <p>‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá JavaScript ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        </div>
    </noscript>
    
    <div class="attempt-counter" id="attempt-counter">
        ‡¶™‡ßç‡¶∞‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ: <span id="attempt-count">0</span>
    </div>
    
    <div id="popup-overlay" class="hidden">
        <div class="popup-content">
            <div class="popup-icon">‚ö†Ô∏è</div>
            <div class="popup-title">‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶≤‡¶ï!</div>
            <div class="nav-buttons-popup">
                <div class="nav-button-popup">‚Üê</div>
                <div class="nav-button-popup">‚óØ</div>
                <div class="nav-button-popup">‚ò∞</div>
            </div>
            <div class="popup-message" id="popup-details">
                ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®!
            </div>
            <div class="popup-penalty" id="popup-penalty">
                +‡ß©‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!
            </div>
            <div class="loading-spinner"></div>
            <button id="popup-close">‡¶Ö‡¶ü‡ßã ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="auto-return-notice" class="hidden">
        üîÑ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
    </div>
    
    <div class="container">
        <h1>‚è≥ ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</h1>
        <div id="timer" aria-live="polite">5:00</div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="message">
            <span class="status-indicator status-active"></span>
            ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º: <span id="user-id">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>
        </div>
        
        <p class="navigation-blocked">üö´ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶≤‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</p>
        <p class="warning">‚Ä¢ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá<br>
           ‚Ä¢ ‡¶¨‡¶ü ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá<br>
           ‚Ä¢ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p>
        <p class="warning" id="connection-status">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó: ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <script>
        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ WebApp ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
        const tg = window.Telegram.WebApp;
        
        // ‡¶¨‡¶ü API ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
        const BOT_TOKEN = '8524488850:AAFEMnAhznZaCoGAkKNQviWmZVlQLB1DANE'; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ü ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¶‡¶ø‡¶®
        
        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
        let timeLeft = 300; // ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü
        let isLocked = true;
        let navButtonAttempts = 0;
        let isPopupShowing = false;
        let autoReturnTimer = null;
        let syncInterval = null;
        let userId = null;
        let isOnline = true;

        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ WebApp ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
        function initializeTelegramApp() {
            tg.ready();
            tg.expand();
            tg.disableClosingConfirmation();
            
            // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            userId = tg.initDataUnsafe?.user?.id;
            if (userId) {
                document.getElementById('user-id').textContent = `‡¶á‡¶â‡¶ú‡¶æ‡¶∞: ${userId}`;
            }
            
            // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶•‡¶ø‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®
            applyTelegramTheme();
            
            // ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
            initializeLockSystem();
        }

        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶•‡¶ø‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡¶á
        function applyTelegramTheme() {
            document.body.style.backgroundColor = tg.themeParams.bg_color || '#1a2a6c';
            document.body.style.color = tg.themeParams.text_color || 'white';
        }

        // ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶≤‡¶ï ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
        function initializeLockSystem() {
            // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            restoreTimerState();
            
            // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®
            activateTelegramRestrictions();
            
            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
            startServerSync();
            
            // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®
            setupEventListeners();
            
            // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
            startMainTimer();
            
            // ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡¶®‡¶ø‡¶ü‡¶∞‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
            startNetworkMonitoring();
        }

        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®
        async function activateTelegramRestrictions() {
            try {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                await restrictUserInteractions();
                
                // Cloud Storage-‡¶è ‡¶≤‡¶ï ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                saveToCloudStorage();
                
                tg.showAlert("üö´ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶≤‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º! ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            } catch (error) {
                console.error('‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶è‡¶∞‡¶∞:', error);
                tg.showAlert("‚ö†Ô∏è ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶è‡¶∞‡¶∞, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶≤‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶Ü‡¶õ‡ßá");
            }
        }

        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        async function restrictUserInteractions() {
            if (!userId) return;
            
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/restrictChatMember`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: userId,
                    user_id: userId,
                    permissions: {
                        can_send_messages: false,
                        can_send_media_messages: false,
                        can_send_polls: false,
                        can_send_other_messages: false,
                        can_add_web_page_previews: false,
                        can_change_info: false,
                        can_invite_users: false,
                        can_pin_messages: false
                    },
                    until_date: Math.floor(Date.now() / 1000) + 3600 // ‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ
                })
            });
            
            return await response.json();
        }

        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶Ü‡¶®‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        async function unrestrictUserInteractions() {
            if (!userId) return;
            
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/restrictChatMember`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: userId,
                    user_id: userId,
                    permissions: {
                        can_send_messages: true,
                        can_send_media_messages: true,
                        can_send_polls: true,
                        can_send_other_messages: true,
                        can_add_web_page_previews: true,
                        can_change_info: true,
                        can_invite_users: true,
                        can_pin_messages: true
                    }
                })
            });
            
            return await response.json();
        }

        // ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®
        async function sendRedirectNotification() {
            if (!userId) return;
            
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: userId,
                    text: "üö´ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶®‡¶ø‡¶∑‡¶ø‡¶¶‡ßç‡¶ß! WebApp-‡¶è ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡ßÅ‡¶®‡•§",
                    reply_markup: {
                        inline_keyboard: [[
                            { 
                                text: "üì± WebApp-‡¶è ‡¶´‡¶ø‡¶∞‡ßÅ‡¶®", 
                                web_app: { url: window.location.href } 
                            }
                        ]]
                    }
                })
            });
            
            return await response.json();
        }

        // Cloud Storage-‡¶è ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
        function saveToCloudStorage() {
            const state = { 
                timeLeft, 
                isLocked, 
                userId,
                timestamp: Date.now(),
                attempts: navButtonAttempts 
            };
            
            tg.CloudStorage.setItem('global_lock_state', JSON.stringify(state), (err) => {
                if (!err) {
                    console.log('Cloud Storage ‡¶∏‡ßá‡¶≠ÊàêÂäü');
                }
            });
        }

        // Cloud Storage ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        function loadFromCloudStorage(callback) {
            tg.CloudStorage.getItem('global_lock_state', (err, value) => {
                if (!err && value) {
                    const state = JSON.parse(value);
                    callback(state);
                } else {
                    callback(null);
                }
            });
        }

        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        async function syncWithServer() {
            if (!isOnline) return;
            
            try {
                const state = {
                    userId,
                    timeLeft,
                    isLocked,
                    attempts: navButtonAttempts,
                    timestamp: Date.now(),
                    userAgent: navigator.userAgent
                };
                
                const response = await fetch(`${SERVER_URL}/sync-lock-state`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(state)
                });
                
                if (response.ok) {
                    updateConnectionStatus(true);
                }
            } catch (error) {
                updateConnectionStatus(false);
                console.error('‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶è‡¶∞‡¶∞:', error);
            }
        }

        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
        async function restoreFromServer() {
            if (!userId || !isOnline) return;
            
            try {
                const response = await fetch(`${SERVER_URL}/get-lock-state?userId=${userId}`);
                if (response.ok) {
                    const state = await response.json();
                    if (state && state.isLocked && state.timeLeft > 0) {
                        timeLeft = state.timeLeft;
                        isLocked = true;
                        updateTimerDisplay();
                        tg.showAlert("üîí ‡¶≤‡¶ï ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ÊàêÂäü!");
                    }
                }
            } catch (error) {
                console.error('‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶è‡¶∞‡¶∞:', error);
            }
        }

        // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞
        function restoreTimerState() {
            loadFromCloudStorage((state) => {
                if (state && state.isLocked && state.timeLeft > 0) {
                    timeLeft = state.timeLeft;
                    isLocked = true;
                    navButtonAttempts = state.attempts || 0;
                    updateTimerDisplay();
                    updateAttemptCounter();
                    
                    // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®
                    restoreFromServer();
                }
            });
        }

        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
        function startServerSync() {
            // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
            syncWithServer();
            
            // ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
            syncInterval = setInterval(() => {
                if (isLocked) {
                    syncWithServer();
                    saveToCloudStorage();
                }
            }, 10000);
        }

        // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
        function setupEventListeners() {
            // ‡¶≠‡¶ø‡¶ú‡¶ø‡¶¨‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶ö‡ßá‡¶û‡ßç‡¶ú (‡¶π‡ßã‡¶Æ/‡¶∞‡¶ø‡¶∏‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶®)
            document.addEventListener('visibilitychange', handleVisibilityChange);
            
            // ‡¶™‡ßá‡¶ú ‡¶Ü‡¶®‡¶≤‡ßã‡¶° ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡ßá‡¶®‡¶∂‡¶®
            window.addEventListener('beforeunload', handleBeforeUnload);
            
            // ‡¶ï‡ßÄ‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï
            document.addEventListener('keydown', handleKeyDown, true);
            
            // ‡¶ü‡¶æ‡¶ö ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï
            document.addEventListener('touchstart', handleTouch, { passive: false });
            document.addEventListener('touchmove', handleTouch, { passive: false });
            
            // ‡¶ï‡¶®‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶¨‡ßç‡¶≤‡¶ï
            document.addEventListener('contextmenu', handleContextMenu, true);
            
            // ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶ö‡ßá‡¶û‡ßç‡¶ú
            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);
            
            // ‡¶™‡¶™‡¶Ü‡¶™ ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶¨‡¶æ‡¶ü‡¶®
            document.getElementById('popup-close').addEventListener('click', hidePopup);
        }

        // ‡¶≠‡¶ø‡¶ú‡¶ø‡¶¨‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        function handleVisibilityChange() {
            if (!isLocked) return;
            
            if (document.hidden) {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
                navButtonAttempts++;
                updateAttemptCounter();
                
                // ‡¶™‡¶™‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                showNavigationPopup("‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶®‡¶ø‡¶∑‡¶ø‡¶¶‡ßç‡¶ß!");
                
                // ‡¶™‡ßá‡¶®‡¶æ‡¶≤‡ßç‡¶ü‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                const penalty = Math.min(60, navButtonAttempts * 15);
                timeLeft += penalty;
                updateTimerDisplay();
                
                document.getElementById('popup-penalty').textContent = 
                    `+${penalty} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`;
                
                // ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                sendRedirectNotification();
                
                // ‡¶Ö‡¶ü‡ßã ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
                startAutoReturn();
                
                // ‡¶≠‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶®
                tg.HapticFeedback.impactOccurred('heavy');
                
            } else if (isPopupShowing) {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶∏‡ßá‡¶õ‡ßá
                hidePopup();
            }
        }

        // ‡¶Ö‡¶ü‡ßã ‡¶∞‡¶ø‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ
        function startAutoReturn() {
            showAutoReturnNotice();
            
            if (autoReturnTimer) clearInterval(autoReturnTimer);
            
            autoReturnTimer = setInterval(() => {
                if (document.hidden && isLocked) {
                    // WebApp-‡¶è ‡¶´‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶®‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®
                    tg.switchInlineQuery('', 'current_chat');
                    window.focus();
                    
                    // ‡¶´‡ßã‡¶∞‡ßç‡¶∏ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
                    simulateUserActivity();
                    
                } else {
                    // ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶∏‡ßá‡¶õ‡ßá
                    clearInterval(autoReturnTimer);
                    hideAutoReturnNotice();
                }
            }, 1000);
        }

        function simulateUserActivity() {
            const events = ['click', 'touchstart', 'keydown'];
            events.forEach(eventType => {
                const event = new Event(eventType, { bubbles: true });
                document.dispatchEvent(event);
            });
        }

        // ‡¶™‡ßá‡¶ú ‡¶Ü‡¶®‡¶≤‡ßã‡¶° ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡ßá‡¶®‡¶∂‡¶®
        function handleBeforeUnload(e) {
            if (isLocked) {
                e.preventDefault();
                e.returnValue = 'üö´ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶®‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶¨‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ!';
                return e.returnValue;
            }
        }

        // ‡¶ï‡ßÄ‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        function handleKeyDown(e) {
            if (isLocked) {
                e.preventDefault();
                e.stopPropagation();
                
                if (e.key === 'Escape') {
                    tg.showAlert("ESC ‡¶ï‡ßÄ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                }
                
                return false;
            }
        }

        // ‡¶ü‡¶æ‡¶ö ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        function handleTouch(e) {
            if (isLocked) {
                e.preventDefault();
            }
        }

        // ‡¶ï‡¶®‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        function handleContextMenu(e) {
            if (isLocked) {
                e.preventDefault();
                e.stopPropagation();
                tg.showAlert("‡¶∞‡¶æ‡¶á‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                return false;
            }
        }

        // ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        function handleOnline() {
            isOnline = true;
            updateConnectionStatus(true);
            syncWithServer();
        }

        function handleOffline() {
            isOnline = false;
            updateConnectionStatus(false);
            tg.showAlert("‚ö†Ô∏è ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®! ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶≤‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§");
        }

        // ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞
        function startMainTimer() {
            const timer = setInterval(() => {
                if (!isLocked) {
                    clearInterval(timer);
                    return;
                }
                
                timeLeft--;
                updateTimerDisplay();
                
                // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                if (timeLeft % 10 === 0) {
                    saveToCloudStorage();
                    syncWithServer();
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    unlockSystem();
                }
            }, 1000);
        }

        // ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶®‡¶≤‡¶ï
        async function unlockSystem() {
            isLocked = false;
            
            try {
                // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶§‡ßÅ‡¶≤‡ßá ‡¶®‡¶ø‡¶®
                await unrestrictUserInteractions();
                
                // ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú
                tg.CloudStorage.removeItem('global_lock_state');
                
                // ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶≠‡¶æ‡¶≤
                if (syncInterval) clearInterval(syncInterval);
                if (autoReturnTimer) clearInterval(autoReturnTimer);
                
                // ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
                tg.showAlert("üéâ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑! ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", () => {
                    tg.close();
                });
                
            } catch (error) {
                console.error('‡¶Ü‡¶®‡¶≤‡¶ï ‡¶è‡¶∞‡¶∞:', error);
                tg.showAlert("‚úÖ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑! ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            }
        }

        // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            const progressPercent = (300 - timeLeft) / 300 * 100;
            document.getElementById('progress-bar').style.width = `${progressPercent}%`;
        }

        function updateAttemptCounter() {
            document.getElementById('attempt-count').textContent = navButtonAttempts;
        }

        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connection-status');
            if (connected) {
                statusElement.innerHTML = '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó: <span style="color:#4CAF50">‚úÖ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</span>';
            } else {
                statusElement.innerHTML = '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó: <span style="color:#ff4444">‚ùå ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®</span>';
            }
        }

        // ‡¶™‡¶™‡¶Ü‡¶™ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        function showNavigationPopup(message) {
            if (isPopupShowing) return;
            
            isPopupShowing = true;
            const popup = document.getElementById('popup-overlay');
            const details = document.getElementById('popup-details');
            
            details.textContent = message;
            popup.classList.remove('hidden');
        }

        function hidePopup() {
            isPopupShowing = false;
            document.getElementById('popup-overlay').classList.add('hidden');
            
            if (autoReturnTimer) {
                clearInterval(autoReturnTimer);
                hideAutoReturnNotice();
            }
        }

        function showAutoReturnNotice() {
            document.getElementById('auto-return-notice').classList.remove('hidden');
        }

        function hideAutoReturnNotice() {
            document.getElementById('auto-return-notice').classList.add('hidden');
        }

        // ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡¶®‡¶ø‡¶ü‡¶∞‡¶ø‡¶Ç
        function startNetworkMonitoring() {
            setInterval(() => {
                updateConnectionStatus(navigator.onLine);
            }, 5000);
        }

        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
        document.addEventListener('DOMContentLoaded', initializeTelegramApp);

        // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® (‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('SW ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®ÊàêÂäü'))
                .catch(error => console.log('SW ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®Â§±Ë¥•'));
        }

    </script>
</body>
</html>
